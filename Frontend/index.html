<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‹›è˜ç½‘ç«™ - é¦–é¡µ</title>
    <link rel="stylesheet" href="css/common.css">
    <style>
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 2rem;
            text-align: center;
            margin-bottom: 3rem;
        }

            .hero h1 {
                font-size: 2.5rem;
                margin-bottom: 1rem;
            }

            .hero p {
                font-size: 1.25rem;
                opacity: 0.9;
            }

        .job-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        .job-card {
            background: #fff;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
        }

            .job-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            }

        .job-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 0.5rem;
        }

        .job-company {
            color: #6b7280;
            margin-bottom: 0.5rem;
        }

        .job-info {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            font-size: 0.875rem;
            color: #6b7280;
        }

        .job-salary {
            color: #ef4444;
            font-weight: 600;
        }

        .search-section {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        .search-form {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

            .search-form input {
                flex: 1;
                min-width: 200px;
            }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>

    <div class="hero">
        <h1>æ¬¢è¿æ¥åˆ°æ‹›è˜ç½‘ç«™</h1>
        <p>æ‰¾åˆ°ç†æƒ³çš„å·¥ä½œï¼Œæˆ–æ‹›è˜ä¼˜ç§€çš„äººæ‰</p>
    </div>

    <div class="container">
        <div class="search-section">
            <form class="search-form" id="searchForm">
                <input type="text" id="keyword" placeholder="æœç´¢èŒä½ã€å…¬å¸..." class="form-group input">
                <input type="text" id="location" placeholder="å·¥ä½œåœ°ç‚¹" class="form-group input">
                <button type="submit" class="btn btn-primary">æœç´¢</button>
            </form>
        </div>

        <div class="card">
            <h2 class="card-title">çƒ­é—¨èŒä½</h2>
            <div class="job-list" id="jobList">
                <!-- èŒä½åˆ—è¡¨å°†é€šè¿‡JSåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </div>

    <script src="js/api.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/navigation.js"></script>
    <script>
        // èŒä½æ•°æ®
        let jobsCache = [];

        // ä»åç«¯åŠ è½½èŒä½æ•°æ®
        async function loadJobs(params = {}) {
            try {
                const data = await Api.apiListJobs(params);
                jobsCache = Array.isArray(data) ? data : (data?.items || []);
                renderJobs(jobsCache);
            } catch (e) {
                showAlert(e.message || 'è·å–èŒä½å¤±è´¥', 'error');
                renderJobs([]);
            }
        }

        // æ¸²æŸ“èŒä½åˆ—è¡¨
        function renderJobs(jobs = jobsCache) {
            const jobList = document.getElementById('jobList');
            if (jobs.length === 0) {
                jobList.innerHTML = '<div class="empty-state"><p>æš‚æ— èŒä½ä¿¡æ¯</p></div>';
                return;
            }

            jobList.innerHTML = jobs.map(job => `
                    <div class="job-card" onclick="viewJob('${job.id}')">
                        <div class="job-title">${job.title}</div>
                        <div class="job-company">${job.company}</div>
                        <div>${job.description}</div>
                        <div class="job-info">
                            <span>ğŸ“ ${job.location}</span>
                            <span class="job-salary">ğŸ’° ${job.salary}</span>
                        </div>
                    </div>
                `).join('');
        }

        // æŸ¥çœ‹èŒä½è¯¦æƒ…ï¼ˆè¿™é‡Œå¯ä»¥æ‰©å±•ä¸ºè¯¦æƒ…é¡µï¼‰
        function viewJob(jobId) {
            const role = getCurrentRole();
            if (role === USER_ROLES.JOBHUNTER) {
                // æ±‚èŒè€…å¯ä»¥ç”³è¯·èŒä½
                if (confirm('ç¡®å®šè¦ç”³è¯·è¿™ä¸ªèŒä½å—ï¼Ÿ')) {
                    applyJob(jobId);
                }
            } else {
                alert('è¯·å…ˆç™»å½•ä¸ºæ±‚èŒè€…èº«ä»½');
            }
        }

        // ç”³è¯·èŒä½
        function applyJob(jobId) {
            const user = getCurrentUser();
            if (!user) {
                window.location.href = 'login.html';
                return;
            }
            // jobId æ˜¯æ•°æ®åº“ä¸»é”®ï¼ŒhunterId ç”±åç«¯ä» sessionId è·å–
            Api.apiApplyJob(jobId)
                .then(() => alert('ç”³è¯·æˆåŠŸï¼'))
                .catch(err => alert(err.message || 'ç”³è¯·å¤±è´¥'));
        }

        // æœç´¢åŠŸèƒ½
        document.getElementById('searchForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const keyword = document.getElementById('keyword').value.toLowerCase();
            const location = document.getElementById('location').value.toLowerCase();

            const filtered = jobsCache.filter(job => {
                const matchKeyword = !keyword ||
                    job.title.toLowerCase().includes(keyword) ||
                    job.company.toLowerCase().includes(keyword) ||
                    job.description.toLowerCase().includes(keyword);
                const matchLocation = !location || job.location.toLowerCase().includes(location);
                return matchKeyword && matchLocation;
            });

            renderJobs(filtered);
        });

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        loadJobs();
    </script>
</body>
</html>


